<%- layout("layouts/navbar") %>

<div class="max-w-4xl mx-auto p-4">
  <!-- HEADER -->
  <div class="flex items-center justify-between mb-4">
    <h2 class="text-2xl font-bold">Wallet</h2>
    <a href="/contact-us" class="flex items-center gap-1 text-sm text-gray-600">
      <i class="fa-solid fa-headphones"></i> Help
    </a>
  </div>

  <!-- PAY BUTTON -->
  

  <!-- OFFERS -->
  <div class="flex items-center justify-between mb-3">
    <h3 class="font-semibold text-gray-700">Select Offers</h3>
    <button class="text-sm text-green-600 font-semibold">
      Change Amount?
    </button>
  </div>

  <!-- COINS GRID -->
  <div class="grid grid-cols-3 gap-3">
    
    <% const packs = [
      { coins: 165, price: 89, extra: "85% Extra" },
      { coins: 120, price: 120 },
      { coins: 249, price: 249 },
      { coins: 431, price: 399, extra: "8% Extra" },
      { coins: 599, price: 500 },
      { coins: 1110, price: 999, extra: "11% Extra" },
      { coins: 1099, price: 1000 },
      { coins: 1999, price: 1800 },
      { coins: 2999, price: 2000 }
    ]; %>

    <% packs.forEach(pack => { %>
      <div
        onclick="buyCoins(<%= pack.price %>, <%= pack.coins %>)"
        class="relative bg-white border rounded-xl shadow-sm p-4 text-center cursor-pointer hover:shadow-md transition"
      >
        <!-- EXTRA BADGE -->
        <% if (pack.extra) { %>
          <span class="absolute top-0 left-0 bg-red-600 text-white text-xs px-2 py-1 rounded-br-lg rounded-tl-lg">
            <%= pack.extra %>
          </span>
        <% } %>

        <!-- COIN ICON -->
        <div class="flex justify-center mb-2">
          <div class="w-8 h-8 bg-yellow-100 rounded-full flex items-center justify-center">
            ðŸª™
          </div>
        </div>

        <!-- COINS -->
        <p class="text-lg font-bold text-gray-800">
          <%= pack.coins %>
        </p>
        <p class="text-sm text-gray-500">Coins</p>

        <!-- PRICE -->
        <div class="mt-3 bg-green-100 text-green-700 rounded-full py-1 text-sm font-semibold">
          â‚¹ <%= pack.price %>
        </div>
      </div>
    <% }) %>

  </div>
</div>

<script src="https://checkout.razorpay.com/v1/checkout.js"></script>

<script>
async function buyCoins(amount, coins) {
  const res = await fetch("/create-order", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ amount })
  });

  const data = await res.json();

  const rzp = new Razorpay({
    key: "<%= process.env.Razor_key_id %>",
    amount: amount * 100,
    currency: "INR",
    name: "Shaadiwali Coins",
    description: `${coins} Coins`,
    order_id: data.orderId,
    handler: async (response) => {
      await fetch("/tokens/verify", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          ...response,
          tokens: coins
        })
      });
      alert("ðŸª™ Coins added successfully!");
      window.location.reload();
    }
  });

  rzp.open();
}
</script>
