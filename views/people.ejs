<%- layout("/layouts/navbar.ejs") %>

<div class="min-h-screen bg-gray-50 px-4 md:px-20 py-8">


  <!-- PAGE GRID -->
  <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
    
    <!-- MOBILE FILTER TOGGLE -->
<div class="md:hidden mb-4">
  <button
    id="toggleFilters"
    class="w-full bg-blue-600 text-white py-2 rounded-lg font-semibold"
  >
    ğŸ” Show Filters
  </button>
</div>


    <!-- ğŸ” FILTER SIDEBAR -->
    <aside
  id="filterSidebar"
  class="hidden md:block md:col-span-1 bg-white rounded-2xl shadow-md p-4 md:p-6 h-fit md:sticky md:top-24"
>



      <h2 class="text-lg font-semibold text-gray-900 mb-4">Filters</h2>

      <form id="filterForm" method="GET" action="/people" class="space-y-4">

        <!-- AGE RANGE -->
        <div class="flex gap-2">
          <input
            type="number"
            name="minAge"
            placeholder="Min Age"
            value="<%= query?.minAge || '' %>"
            class="w-1/2 px-3 py-2 border rounded-md focus:ring-2 focus:ring-blue-400 focus:outline-none"
          />
          <input
            type="number"
            name="maxAge"
            placeholder="Max Age"
            value="<%= query?.maxAge || '' %>"
            class="w-1/2 px-3 py-2 border rounded-md focus:ring-2 focus:ring-blue-400 focus:outline-none"
          />
        </div>

        <!-- GENDER -->
        <select
          name="gender"
          class="w-full px-3 py-2 border rounded-md focus:ring-2 focus:ring-blue-400 focus:outline-none"
        >
          <option value="">Any Gender</option>
          <option value="Male" <%= query?.gender === "Male" ? "selected" : "" %>>Male</option>
          <option value="Female" <%= query?.gender === "Female" ? "selected" : "" %>>Female</option>
          <option value="Other" <%= query?.gender === "Other" ? "selected" : "" %>>Other</option>
        </select>

        <!-- INTEREST -->
        <input
          type="text"
          name="interest"
          placeholder="Search by interest"
          value="<%= query?.interest || '' %>"
          class="w-full px-3 py-2 border rounded-md focus:ring-2 focus:ring-blue-400 focus:outline-none"
        />

        <!-- BUTTONS -->
        <button
          type="submit"
          class="w-full bg-blue-600 text-white py-2 rounded-md hover:bg-blue-700 transition"
        >
          Apply Filters
        </button>

        <a href="/people" class="block text-center text-sm text-gray-500 hover:underline">
          Clear all filters
        </a>
        <% if (userProfile?.isSubscribed) { %>
          <div class="mt-6">
            <a
              href="/choosing"
              class="w-full flex items-center justify-center gap-2
                     bg-pink-600 text-white py-3 rounded-lg font-semibold
                     shadow-md hover:bg-pink-700 transition"
            >
              ğŸ”€ Go to Choicing View
            </a>
          </div>
        <% } else { %>
          <div class="mt-6 p-3 text-sm bg-gray-100 text-gray-600 rounded-lg text-center">
            Upgrade to use Choicing View ğŸ”’
          </div>
        <% } %>
        
      </form>
    </aside>
    <!-- GO TO CHOICING VIEW BUTTON -->

  
    

    <!-- ğŸªª CARDS SECTION (UNCHANGED) -->
    <section class="md:col-span-3">

      <% if (limit > 0 && people.length === limit) { %>
        <div class="mb-6 p-4 bg-yellow-100 border border-yellow-300 rounded-lg text-yellow-800">
          âš ï¸ You are viewing the maximum profiles allowed for your plan.
          <a href="/pricing" class="font-semibold underline ml-1">
            Upgrade to see more â†’
          </a>
        </div>
      <% } %>

      <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-5 md:gap-8 mb-12">


        <% if (people.length === 0) { %>
          <p class="text-gray-500 text-lg col-span-full text-center">
            No matching results found.
          </p>
        <% } %>

        <% people.forEach((person) => { %>
          <a href="/people/<%= person._id %>" class="group">
            
            <div class="bg-white rounded-2xl shadow-lg hover:shadow-2xl transition overflow-hidden">

              <div class="relative">
                <img
                  src="<%= person.image || 'https://ui-avatars.com/api/?name=' + person.first_name %>"
                  alt="Profile"
                  class="w-full h-44 sm:h-52 object-cover"

                />

                <div class="absolute top-3 left-3 flex gap-2">

                  <% if (person.isVerified) { %>
                    <span class="bg-blue-100 text-blue-700 text-xs font-semibold px-3 py-1 rounded-full flex items-center gap-1">
                      âœ“ Verified
                    </span>
                  <% } %>
                
                  <% if (person.isSubscribed) { %>
                    <span class="bg-green-100 text-green-600 text-xs font-semibold px-3 py-1 rounded-full">
                      Featured
                    </span>
                  <% } %>
                
                </div>
                
              </div>

              <div class="p-5 space-y-2">
                <h3 class="text-lg font-bold text-gray-900">
                  <%= person.first_name %> <%= person.last_name %>
                </h3>

                <p class="text-sm text-gray-500">
                  ğŸ“ <%= person.address || "Location not specified" %>
                </p>

                <p class="text-gray-700 font-medium">
                  <%= person.work || "Professional Profile" %>
                </p>

                <div class="flex justify-between text-sm text-gray-600 pt-2">
                  <span>ğŸ‚ <%= person.age || "N/A" %> yrs</span>
                  <span>âš§ <%= person.gender || "N/A" %></span>
                </div>

                <div class="pt-3 border-t text-xs text-gray-500">
                  Listed by <span class="font-semibold text-gray-700">Shaadiwali</span>
                </div>
              </div>

            </div>
          </a>
        <% }) %>

      </div>
    </section>

  </div>
</div>
<script>
  const toggleBtn = document.getElementById("toggleFilters");
  const sidebar = document.getElementById("filterSidebar");

  if (toggleBtn) {
    toggleBtn.addEventListener("click", () => {
      sidebar.classList.toggle("hidden");
      toggleBtn.innerText = sidebar.classList.contains("hidden")
        ? "ğŸ” Show Filters"
        : "âŒ Hide Filters";
    });
  }
</script>


<%- include("layouts/footer.ejs") %>
